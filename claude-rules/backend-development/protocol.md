# üîß Backend Development Protocol for Claude

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è Backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å Claude AI.

## üéØ –°—Ñ–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

- REST API development
- GraphQL APIs
- Microservices architecture
- Database modelling & migrations
- API authentication & authorization
- Performance optimization

## üîÑ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –§–ê–ó–ê 1: Backend Architect (–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

–î–µ–π—Å—Ç–≤—É–π –∫–∞–∫ Senior Backend Architect.

#### –ó–∞–¥–∞—á–∏:
1. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoints
2. –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–ª–æ—ë–≤
4. –í—ã–±–æ—Ä –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
5. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö endpoint'–æ–≤

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (STRICT):
- ‚ùå –ù–ï –ø–∏—à–∏ –∫–æ–¥ –≤ —ç—Ç–æ–π —Ñ–∞–∑–µ
- ‚ùå –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- ‚úÖ –¢–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑

#### –í—ã—Ö–æ–¥ (Deliverables):
```markdown
# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: [Feature Name]

## API Endpoints
| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | Request | Response |
|--------|----------|----------|---------|----------|
| GET | /api/resource | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ | - | Resource[] |
| POST | /api/resource | –°–æ–∑–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å | ResourceDTO | Resource |
| PUT | /api/resource/:id | –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ—Å—É—Ä—Å | ResourceDTO | Resource |
| DELETE | /api/resource/:id | –£–¥–∞–ª–∏—Ç—å —Ä–µ—Å—É—Ä—Å | - | void |

## Database Schema
- Table: [–∏–º—è —Ç–∞–±–ª–∏—Ü—ã]
- –ö–æ–ª–æ–Ω–∫–∏: [—Å–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫]
- –ò–Ω–¥–µ–∫—Å—ã: [—Å–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤]
- –û—Ç–Ω–æ—à–µ–Ω–∏—è: [ERD –¥–∏–∞–≥—Ä–∞–º–º–∞ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ]

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–æ—ë–≤
- [Layer 1]: [–æ–ø–∏—Å–∞–Ω–∏–µ]
- [Layer 2]: [–æ–ø–∏—Å–∞–Ω–∏–µ]

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [–ü–∞—Ç—Ç–µ—Ä–Ω 1]: [–æ–ø–∏—Å–∞–Ω–∏–µ]
- [–ü–∞—Ç—Ç–µ—Ä–Ω 2]: [–æ–ø–∏—Å–∞–Ω–∏–µ]

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- Backend: [Node.js/Python/Go]
- Database: [PostgreSQL/MySQL/MongoDB]
- Cache: [Redis/Memcached]
- Message Queue: [RabbitMQ/Kafka]

## Performance Requirements
- Max response time: [Target]
- Max requests per second: [Target]
```
```

**–§–ê–ó–ê 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ñ–¥—É –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –§–ê–ó–ï 2.**
```

### –§–ê–ó–ê 2: Backend Developer (–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

–î–µ–π—Å—Ç–≤—É–π –∫–∞–∫ Backend Developer.

#### –¢–≤–æ–π —Å—Ç–µ–∫ (STRICT):
```yaml
Backend Frameworks:
  - Node.js: Express 18+ (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ)
  - Python: FastAPI 0.104+ (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ)
  - Go: Echo/Fiber (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ)
  
Database:
  - PostgreSQL: Prisma ORM (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ)
  - MySQL: TypeORM (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ)
  - MongoDB: Mongoose (–ø—Ä–∏ –≤—ã–±–æ—Ä–µ)
  
Validation:
  - Zod (–¥–ª—è –≤—Å–µ—Ö)
  - Pydantic (–¥–ª—è Python)
  
Authentication:
  - JWT tokens (–¥–ª—è REST)
  - OAuth2 (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
  
Testing:
  - Jest/Pytest
  - Supertest/Testcontainers
  
Code Style:
  - TypeScript strict mode (–¥–ª—è Node.js)
  - type hints (–¥–ª—è Python)
  - Black formatting (–¥–ª—è Python)
  
Security:
  - bcrypt/argon2 (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - helmet (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
  - rate-limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤)
```

#### –ó–∞–ø—Ä–µ—â–µ–Ω–æ (STRICT):
```yaml
‚ùå SQL injection risk (–±–µ–∑ ORM/raw queries)
‚ùå Hardcoded secrets/credentials
‚ùå Weak password hashing (–±–µ–∑ salt/–∏—Ç–µ—Ä–∞—Ü–∏–π < 10000)
‚ùå Missing authentication/authorization
‚ùå No input validation
‚ùå No error handling
‚ùå No rate limiting –Ω–∞ public endpoints
‚ùå XSS vulnerabilities (–Ω–µ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML)
‚ùå CORS misconfiguration (—Ä–∞–∑—Ä–µ—à–µ–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

1. **Architecture**
```typescript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π dependency injection
import { Controller, Get, Post, Put, Delete } from 'ts-rest-operations';

export const createResourceController = () => {
  const router = new Router();
  
  const repo = new ResourceRepository();
  const controller = new ResourceController(repo);
  
  router.post('/resources', controller.create.bind(controller));
  router.get('/resources/:id', controller.getById.bind(controller));
  
  return router;
};

// ‚ùå –ù–µ –ø–∏—à–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª—ë—Ä–µ
class ResourceController extends BaseController {
  create(req: Request, res: Response) {
    // –¢–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞
    return this.service.create(req.body);
  }
}
```

2. **Database**
```sql
-- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π NUMERIC –¥–ª—è –¥–µ–Ω–µ–≥
CREATE TABLE transactions (
  id BIGSERIAL PRIMARY KEY,
  amount NUMERIC(15,2) NOT NULL,
  -- ...
);

-- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π FLOAT –¥–ª—è –¥–µ–Ω–µ–≥
CREATE TABLE transactions (
  amount FLOAT,  -- –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏!
  ...
);

-- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Proper Indexes
CREATE INDEX idx_user_email ON users (email);

-- ‚ùå –ù–µ —Å–æ–∑–¥–∞–≤–∞–π composite index –±–µ–∑ –Ω—É–∂–¥—ã
CREATE INDEX idx_user_name_email ON users (name, email);  -- –ò–∑–±—ã—Ç–æ—á–Ω–æ
```

3. **Validation**
```typescript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Zod –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
import { z } from 'zod';

const userSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
  confirmPassword: z.string(),
});

// ‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–π –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
export const validateUserInput = (data: unknown) => userSchema.parse(data);

// ‚ùå –ù–µ –≤–∞–ª–∏–¥–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é
export const validateUser = (data: any) => {
  // –†—É—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ Zod
};
```

4. **Error Handling**
```typescript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
class AppError extends Error {
  public readonly statusCode: number;
  public readonly code: string;
  constructor(statusCode: number, code: string, message?: string) {
    super(message);
    this.statusCode = statusCode;
    this.code = code;
  }
}

export const errorHandler = (error: AppError) => {
  console.error(error);
  
  if (!error.statusCode) {
    error.statusCode = 500;
  }
  
  return error;
};

// ‚ùå –ù–µ –≥–ª–æ—Ç–∞–π –æ—à–∏–±–∫–∏
try {
  // –∫–æ–¥
} catch (e) {
  console.error(e);  // –ü—Ä–∞–≤–∏–ª—å–Ω–æ
  throw e;         // –ì–ª–æ—Ç–∫–∞!
}
```

5. **Security**
```typescript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
import bcrypt from 'bcrypt';

const hashPassword = async (password: string): Promise<string> => {
  const salt = await bcrypt.genSalt(10);
  return await bcrypt.hash(password, salt);
};

// ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π md5/sha1 (—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ)
const hashPassword = (password: string): string => {
  const hash = crypto.createHash('md5').update(password).digest('hex');
  return hash;
};

// ‚úÖ JWT —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ (exp)
import jwt from 'jsonwebtoken';

const generateToken = (userId: string): string => {
  return jwt.sign(
    { userId },
    process.env.JWT_SECRET,
    { expiresIn: '1h' }  // Token –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 1 —á–∞—Å
  );
};

// ‚ùå JWT –±–µ–∑ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω)
const generateToken = (userId: string): string => {
  return jwt.sign(
    { userId },
    process.env.JWT_SECRET
    // –ù–µ—Ç expiresIn - –ø–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω!
  );
};

// ‚úÖ Rate limiting
import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,  // 15 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 15 –º–∏–Ω—É—Ç
  max: 100,
});

// ‚ùå –ë–µ–∑ rate limiting –Ω–∞ public endpoints
```

#### –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º:
- [ ] –í—Å–µ endpoint'—ã —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Database schema –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
- [ ] –ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤—ã–±—Ä–∞–Ω—ã
- [ ] –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É—á—Ç–µ–Ω–∞ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, rate limiting)
- [ ] Error handling —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞

---

**–§–ê–ó–ê 2 –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ñ–¥—É –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –§–ê–ó–ï 3.**
```

### –§–ê–ó–ê 3: Backend Validator (–ü—Ä–æ–≤–µ—Ä–∫–∞)

–î–µ–π—Å—Ç–≤—É–π –∫–∞–∫ Backend Code Reviewer.

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–µ–∫–∞:
```typescript
// ‚ùå FAIL –µ—Å–ª–∏:
import python_lib  # Node.js –ø—Ä–æ–µ–∫—Ç, –Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç python
from flask import Flask  # Node.js –ø—Ä–æ–µ–∫—Ç, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Flask

// ‚ùå FAIL –µ—Å–ª–∏ SQL queries –±–µ–∑ ORM
const result = await db.query('SELECT * FROM users WHERE name = ?', [name]);  // Raw SQL!
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
```sql
-- ‚ùå FAIL –µ—Å–ª–∏
-- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (plaintext)
-- –ù–µ—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–∞—Ä–æ–ª–µ–π
-- SQL injection —É—è–∑–≤–∏–º–æ—Å—Ç–∏

-- ‚úÖ PASS –µ—Å–ª–∏
-- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è (bcrypt/argon2)
-- Passwords hashed with salt
-- Prepared statements –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
```typescript
// ‚ùå FAIL –µ—Å–ª–∏
// God object / –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–ª–∞—Å—Å
// Circular dependencies
// Tight coupling –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

// ‚úÖ PASS –µ—Å–ª–∏
// Dependency injection —Å –º–æ–¥—É–ª—è–º–∏
// Repository pattern —Å separation of concerns
// SOLID principles (Single Responsibility, Open/Closed)
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞:
```typescript
// ‚ùå FAIL –µ—Å–ª–∏
// –§—É–Ω–∫—Ü–∏–∏ > 50 —Å—Ç—Ä–æ–∫
// –í–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å > 5 —É—Ä–æ–≤–Ω–µ–π
// –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –±–µ–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç
// –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ > 3 —Ä–∞–∑
// –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ JSDoc/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

// ‚úÖ PASS –µ—Å–ª–∏
// –§—É–Ω–∫—Ü–∏–∏ < 30 —Å—Ç—Ä–æ–∫
// –í–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å < 4 —É—Ä–æ–≤–Ω–µ–π
// –ö–æ–¥ DRY (Don't Repeat Yourself)
// –ï—Å—Ç—å —Ç–∏–ø—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

#### –§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

**–ï–°–õ–ò –û–®–ò–ë–ö–ê:**
```markdown
‚õî BACKEND VALIDATION FAILED

–ü—Ä–∏—á–∏–Ω–∞: [–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞]
Endpoint: [endpoint]
Code file: [path]

–ù–∞—Ä—É—à–µ–Ω–∏–µ:
- [Specific rule from protocol.md]

–î–µ–π—Å—Ç–≤–∏–µ:
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥, —Å–æ–±–ª—é–¥–∞—è –ø—Ä–æ—Ç–æ–∫–æ–ª
- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–í–æ–∑–≤—Ä–∞—Ç –∫ –§–ê–ó–ï 2
```

**–ï–°–õ–ò –í–°–Å OK:**
```markdown
‚úÖ BACKEND VALIDATION PASSED

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- ‚úÖ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ —Å–æ–±–ª—é–¥—ë–Ω
- ‚úÖ Database schema –±–µ–∑–æ–ø–∞—Å–Ω–∞
- ‚úÖ SQL queries –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç injection
- ‚úÖ Authentication —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Error handling —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices
- ‚úÖ Architecture —Å–ª–µ–¥—É–µ—Ç SOLID principles
- ‚úÖ Code quality —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

Backend –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
```

---

## üö® Common Security Vulnerabilities

### SQL Injection
```typescript
// ‚ùå –£–Ø–ó–í–ò–ú–û! Raw SQL queries
const user = await db.query(
  `SELECT * FROM users WHERE email = '${email}'`
);  // –ü–æ–¥—Å—Ç–∞–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π!

// ‚úÖ –ó–ê–©–ò–©–ï–ù–û: –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
const user = await db.query(
  'SELECT * FROM users WHERE email = $1',
  [email]
);
```

### XSS (Cross-Site Scripting)
```typescript
// ‚ùå –£–Ø–ó–í–ò–ú–û! –í—Å—Ç–∞–≤–∫–∞ –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ HTML
app.get('/search', (req, res) => {
  const html = `<div>${req.query.q}</div>`;
  res.send(html);
});

// ‚úÖ –ó–ê–©–ò–©–ï–ù–û: –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML
import DOMPurify from 'dompurify';

app.get('/search', (req, res) => {
  const cleanHtml = DOMPurify.sanitize(req.query.q);
  res.send(cleanHtml);
});
```

### Authentication Bypass
```typescript
// ‚ùå –£–Ø–ó–í–ò–ú–û! –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–æ–∫–µ–Ω
export const authMiddleware = (req, res, next) => {
  const token = req.headers.authorization;
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–∞, –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏!
  if (token) {
    return next();
  }
  
  res.status(401).send('Unauthorized');
};

// ‚úÖ –ó–ê–©–ò–©–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT + –≤–∞–ª–∏–¥–∞—Ü–∏—è
import jwt from 'jsonwebtoken';
import { Request, Response, NextFunction } from 'express';

export const authMiddleware = (req, res, next) => {
  const token = req.headers.authorization?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).send('Unauthorized');
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (err) {
    return res.status(403).send('Invalid token');
  }
};
```

---

## üîß Rabbit Hole Detection

–ï—Å–ª–∏ –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 2 —Ä–∞–∑–∞:

1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Å—å** –∏ –ù–ï –ø–æ–≤—Ç–æ—Ä—è–π –ø–æ–ø—ã—Ç–∫—É
2. **–ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π** –ø—Ä–æ–±–ª–µ–º—É –≤ `docs/BACKEND_DEBUG_REPORT.md`
3. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π**:
   - –≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (–Ω–µ–ø—Ä–∞–≤–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω)?
   - –≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤)?
   - –≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (env variables)?

4. **–ü—Ä–µ–¥–ª–æ–∂–∏** —Ä–µ—à–µ–Ω–∏–µ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∏ –ø–æ–º–æ—â—å

---

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ REST API —Å Express + TypeScript

**–ó–∞–ø—Ä–æ—Å:**
> –°–æ–∑–¥–∞–π REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

**–§–ê–ó–ê 1 - Architect:**
```markdown
# API Endpoints
- GET /api/users - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫
- POST /api/users/register - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- POST /api/users/login - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- POST /api/users/logout - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

# Database Schema
- Table: users
- Columns: id, email, password_hash, created_at

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- Authentication: JWT tokens
- Validation: Zod schemas
- Error handling: Custom AppError

# –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- Node.js 18+
- Express
- TypeScript strict mode
- PostgreSQL + Prisma
```

**–§–ê–ó–ê 2 - Developer:**
```typescript
// controllers/UsersController.ts
import { Router, Request, Response } from 'express';
import { z } from 'zod';
import bcrypt from 'bcrypt';
import { PrismaClient } from '@prisma/client';
import { AppError } from '@/utils/errors';

const prisma = new PrismaClient();

interface RegisterUserDTO {
  email: string;
  password: string;
}

const registerSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
});

export const registerUser = async (req: Request, res: Response) => {
  try {
    const data = registerSchema.parse(req.body);
    
    // –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è
    const hashedPassword = await bcrypt.hash(data.password, 10);
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await prisma.user.create({
      email: data.email,
      password_hash: hashedPassword,
    });
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
    const token = jwt.sign(
      { userId: user.id },
      process.env.JWT_SECRET,
      { expiresIn: '24h' }
    );
    
    res.status(201).json({
      id: user.id,
      email: user.email,
      token,
    });
  } catch (error) {
    if (error instanceof z.ZodError) {
      throw new AppError(400, 'Validation Error', error.errors);
    }
    throw error;
  }
};

// controllers/AuthController.ts
import { Request, Response } from 'express';
import jwt from 'jsonwebtoken';
import { AppError } from '@/utils/errors';

interface LoginDTO {
  email: string;
  password: string;
}

const loginSchema = z.object({
  email: z.string().email(),
  password: z.string(),
});

export const login = async (req: Request, res: Response) => {
  try {
    const data = loginSchema.parse(req.body);
    
    // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await prisma.user.findUnique({
      where: { email: data.email }
    });
    
    if (!user) {
      throw new AppError(401, 'Invalid credentials');
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
    const isValidPassword = await bcrypt.compare(data.password, user.password_hash);
    if (!isValidPassword) {
      throw new AppError(401, 'Invalid credentials');
    }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
    const token = jwt.sign(
      { userId: user.id },
      process.env.JWT_SECRET,
      { expiresIn: '24h' }
    );
    
    res.json({
      id: user.id,
      email: user.email,
      token,
    });
  } catch (error) {
    throw error;
  }
};

// middleware/authMiddleware.ts
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';
import { AppError } from '@/utils/errors';

export const authMiddleware = (req: Request, res: Response, next: NextFunction) => {
  const token = req.headers.authorization?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).send('Unauthorized');
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (err) {
    return res.status(403).send('Invalid token');
  }
};
```

**–§–ê–ó–ê 3 - Validator:**
```markdown
‚úÖ BACKEND VALIDATION PASSED

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- ‚úÖ Node.js —Å Express –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- ‚úÖ TypeScript strict mode —Å–æ–±–ª—é–¥—ë–Ω
- ‚úÖ PostgreSQL + Prisma ORM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- ‚úÖ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ JWT –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ Custom error handling —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ SQL injection –∑–∞—â–∏—â–µ–Ω—ã (—á–µ—Ä–µ–∑ Prisma)
- ‚úÖ XSS –∑–∞—â–∏—â–µ–Ω–æ (—Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞ –¥–ª—è REST API)
- ‚úÖ Authentication bypass –∑–∞—â–∏—â–µ–Ω–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è JWT)

Backend API –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Express Best Practices](https://expressjs.com/en/guide/best-practice-performance.html)
- [Prisma Documentation](https://www.prisma.io/docs)
- [TypeScript Documentation](https://www.typescriptlang.org/docs/)
- [OWASP Security Guidelines](https://owasp.org/www-project-top-ten/)

---
description: –≠–∫—Å–ø–µ—Ä—Ç –ø–æ Supabase. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ Edge Functions.
globs: ["**/supabase/**", "**/*.sql", "**/migrations/**"]
alwaysApply: false
---

# üóÑÔ∏è Supabase Database Rule for Cursor

## –ó–∞—á–µ–º –Ω—É–∂–µ–Ω —ç—Ç–æ—Ç Rule?

Supabase Expert ‚Äî —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–æ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π Supabase. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ Edge Functions.

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Auth)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —Ñ–∞–π–ª–æ–≤ (Storage)
- ‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Edge Functions
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Row Level Security (RLS)
- ‚úÖ Realtime subscriptions

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. RLS (Row Level Security)

**RLS –ø–æ–ª–∏—Ç–∏–∫–∏ ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã!**
- ‚úÖ –í–°–ï —Ç–∞–±–ª–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å RLS
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SECURITY DEFINER —Ñ—É–Ω–∫—Ü–∏–∏
- ‚ùå –ù–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ NEW./OLD. –≤ RLS
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ UNIQUE constraints

### 2. NUMERIC —Ç–∏–ø—ã –¥–ª—è –¥–µ–Ω–µ–≥

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:**
- ‚úÖ –í—Å–µ –¥–µ–Ω–µ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: NUMERIC(15,2)
- ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û: Float, Double, money —Ç–∏–ø—ã
- ‚úÖ –í TypeScript: decimal.js –∏–ª–∏ BigInt

## –û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü:**
```sql
-- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
CREATE TABLE transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  amount NUMERIC(15,2) NOT NULL,  -- –î–ª—è –¥–µ–Ω–µ–≥!
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- RLS –ø–æ–ª–∏—Ç–∏–∫–∞
ALTER TABLE transactions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own transactions"
ON transactions
FOR SELECT
USING (auth.uid() = user_id);
```

**RLS –±–µ–∑ NEW./OLD.:**
```sql
-- ‚ùå –ü–õ–û–•–û - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NEW./OLD.
CREATE POLICY "..." ON transactions
FOR INSERT
WITH CHECK (NEW.amount > 0);

-- ‚úÖ –•–û–†–û–®–û - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SECURITY DEFINER
CREATE OR REPLACE FUNCTION validate_transaction()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.amount <= 0 THEN
    RAISE EXCEPTION 'Amount must be positive';
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Auth)

**–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// lib/supabase.ts
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

**Auth —Ñ—É–Ω–∫—Ü–∏–∏:**
```typescript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'password123',
});

// –í—Ö–æ–¥
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password123',
});
```

### 3. –•—Ä–∞–Ω–∏–ª–∏—â–µ (Storage)

**RLS –¥–ª—è storage:**
```sql
CREATE POLICY "Authenticated write access"
ON storage.objects
FOR INSERT
WITH CHECK (
  bucket_id = 'documents' 
  AND auth.role() = 'authenticated'
  AND auth.uid()::text = (storage.foldername(name))[1]
);
```

### 4. Edge Functions

**–°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```typescript
// supabase/functions/hello/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';

serve(async (req) => {
  const data = await req.json();
  
  return new Response(
    JSON.stringify({ message: `Hello ${data.name}!` }),
    { headers: { 'Content-Type': 'application/json' } }
  );
});
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

‚úÖ **–î–µ–ª–∞–π:**
- –ò—Å–ø–æ–ª—å–∑—É–π NUMERIC(15,2) –¥–ª—è –≤—Å–µ—Ö –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ–ª–µ–π
- –í–∫–ª—é—á–∞–π RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- –ò—Å–ø–æ–ª—å–∑—É–π SECURITY DEFINER —Ñ—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ NEW./OLD.
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- –¢–µ—Å—Ç–∏—Ä—É–π RLS –ø–æ–ª–∏—Ç–∏–∫–∏

‚ùå **–ù–ï –¥–µ–ª–∞–π:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Float/Double –¥–ª—è –¥–µ–Ω–µ–≥
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NEW./OLD. –≤ RLS –ø–æ–ª–∏—Ç–∏–∫–∞—Ö
- –°–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –±–µ–∑ RLS
- –•–∞—Ä–¥–∫–æ–¥–∏—Ç—å credentials –≤ –∫–æ–¥–µ

---

**Supabase Expert –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.**

# Ontology Syncer - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AIRules Accounting

## –¢–≤–æ—è –∑–∞–¥–∞—á–∞

–¢—ã ‚Äî **Ontology Syncer** –¥–ª—è AIRules Accounting. –¢—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—à—å, —á—Ç–æ LLM –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ —Å–≤—è–∑—è—Ö –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π Accounting –¥–æ–º–µ–Ω–∞.

## üéØ –û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏

### 1. –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞
- –ó–∞–ø—É—Å–∫–∞—Ç—å `scripts/ontology/analyze-dependencies.js`
- –ò–∑–≤–ª–µ–∫–∞—Ç—å –≤—Å–µ —Ç–∏–ø—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Ö—É–∫–∏
- –°—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ —Å–≤—è–∑–µ–π (imports/exports)
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–∞—Ö–æ–¥–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Memory Graph MCP
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Memory Graph MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

**create_entities:**
```javascript
{
  entities: [
    {
      name: "Type_Transaction",
      entityType: "typescript_type",
      observations: [
        "Defined in: src/types/Transaction.ts",
        "Category: accounting_type",
        "Exports: 5 items",
        "Used in: TransactionService, AccountBalance, Reporting"
      ]
    }
  ]
}
```

**create_relations:**
```javascript
{
  relations: [
    {
      from: "File_TransactionService.ts",
      to: "File_AccountBalance.ts",
      relationType: "imports_transaction",
      observations: [
        "Import: Transaction interface",
        "From line: 5",
        "Path: @/types/Transaction"
      ]
    }
  ]
}
```

**add_observations:**
```javascript
{
  observations: [
    {
      entityName: "Accounting_Dependency_Graph",
      contents: [
        "Total nodes: 45",
        "Total edges: 120",
        "Cyclic dependencies: 0",
        "Analysis timestamp: 2026-01-08T14:00:00Z",
        "Domain: Accounting",
        "Financial types: NUMERIC(15,2) validated"
      ]
    }
  ]
}
```

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è Accounting –¥–æ–º–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ NUMERIC(15,2) —Ç–∏–ø–æ–≤
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –∫–∞—Ä—Ç
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Transfer vs Expense
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑ NEW./OLD.

### 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Git hooks
- **pre-commit**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
- **pre-push**: –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞:
1. `scripts/ontology/analyze-dependencies.js` ‚Äî –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. `scripts/ontology/validate-graph.js` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞
3. `scripts/ontology/sync-types.js` ‚Äî –±–∞–∑–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä —Ç–∏–ø–æ–≤

### MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
1. `create_entities` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π (—Ç–∏–ø—ã, —Ñ–∞–π–ª—ã, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –º–æ–¥–µ–ª–∏)
2. `create_relations` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π (imports, –±–∏–∑–Ω–µ—Å-–æ—Ç–Ω–æ—à–µ–Ω–∏—è)
3. `add_observations` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (Accounting –ø—Ä–∞–≤–∏–ª–∞)

## üìã –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ (PRE-EDIT ANALYSIS):

**1. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```
LLM –ø—Ä–æ—Ü–µ—Å—Å:
‚Üí search_nodes(query: "Transaction, Account, NUMERIC")
‚Üí –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
  - Transaction.ts (definition)
  - Used in: AccountService.ts, Reporting.tsx, BalanceCalculator.ts
  - Accounting rules: NUMERIC(15,2), pending not affecting balance
```

**2. –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
```
–ò–∑–º–µ–Ω–µ–Ω–∏–µ: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å amount ‚Üí transactionAmount

–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- ‚úó accountService.ts: –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–ª–æ–º–∞–µ—Ç—Å—è
- ‚úó reporting.tsx: –æ—Ç—á—ë—Ç –æ –¥–æ—Ö–æ–¥–∞—Ö/—Ä–∞—Å—Ö–æ–¥–∞—Ö –∏—Å—á–µ–∑–Ω–µ—Ç
- ‚úó balanceCalculator.ts: —Ä–∞—Å—á—ë—Ç—ã –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úó Accounting Constitution: –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Ç–∏–ø–æ–≤

–í—Å–µ–≥–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ: 4 —Ñ–∞–π–ª–∞ + 1 –¥–æ–º–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ
```

**3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
pre-commit hook:
‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è analyze-dependencies.js
‚Üí DEPENDENCIES.json –æ–±–Ω–æ–≤–∏—Ç—Å—è
‚Üí Memory Graph —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è (–µ—Å–ª–∏ MCP –≤–∫–ª—é—á—ë–Ω)
‚Üí Accounting domain validation –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
‚Üí Git commit –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ
```

### –ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Accounting –¥–æ–º–µ–Ω–∞ (PRE-PUSH):

**1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∞:**
```
validate-graph.js:
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–∏–∫–ª—ã
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞
‚Üí –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å Accounting –ø—Ä–∞–≤–∏–ª–∞
```

**2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å push –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö:**
```
Critical Errors:
- ‚õî Cyclic dependencies found
- ‚õî Graph is empty
- ‚õî Report is corrupted
- ‚õî NUMERIC(15,2) not used for money
- ‚õî Credit card logic incorrect
- ‚õî NEW./OLD. in RLS policies

Action:
‚Üí STOP push
‚Üí Show user what to fix
‚Üí Exit with code 1
```

**3. –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å –ø—Ä–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è—Ö:**
```
Warnings:
- ‚ö†Ô∏è Many unused exports (>10)
- ‚ö†Ô∏è Report is stale (>24 hours old)
- ‚ö†Ô∏è High import count per file (>20)

Action:
‚Üí Ask user to continue (y/N)
‚Üí If user says 'N' ‚Üí STOP push
‚Üí If user says 'Y' ‚Üí Allow push
```

## üß† –†–∞–±–æ—Ç–∞ —Å Memory Graph MCP

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Memory Graph:

**‚úÖ –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:**
- –ü–µ—Ä–µ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ ‚Äî –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –ü—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ –±–∞–ª–∞–Ω—Å–æ–≤ ‚Äî –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**‚ùå –ù–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:**
- –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç —É–∂–µ –≤ —Ñ–∞–π–ª–∞—Ö
- –ö–æ–≥–¥–∞ Memory Graph –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### –ó–∞–ø—Ä–æ—Å—ã –∫ Memory Graph:

**–ü–æ–∏—Å–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Ç–∏–ø–∞:**
```javascript
search_nodes(query: "Transaction, NUMERIC, Credit")
// –ù–∞–π—Ç–∏ –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç–∏–ø—ã
```

**–û—Ç–∫—Ä—ã—Ç—å —Å—É—â–Ω–æ—Å—Ç—å:**
```javascript
open_nodes(names: ["Type_Transaction", "Type_Account"])
// –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –º–æ–¥–µ–ª—è—Ö
```

**–ß—Ç–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞:**
```javascript
read_graph()
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏ –≤ Accounting –¥–æ–º–µ–Ω–µ
```

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ùå –ù–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å .git/hooks –Ω–∞–ø—Ä—è–º—É—é (–∏—Å–ø–æ–ª—å–∑—É–π —Å–∫—Ä–∏–ø—Ç—ã)
- ‚ùå –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ Memory Graph –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- ‚ùå –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å git –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏—á–∏–Ω
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –¥–µ–π—Å—Ç–≤–∏—è—Ö
- ‚úÖ –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] Memory Graph —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
- [x] –ì—Ä–∞—Ñ –≤–∞–ª–∏–¥–µ–Ω (–Ω–µ—Ç —Ü–∏–∫–ª–æ–≤)
- [x] Accounting –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–±–ª—é–¥–µ–Ω—ã (NUMERIC, Transfer vs Expense)
- [x] –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã < 10 –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
- [x] –û—Ç—á—ë—Ç –∞–∫—Ç—É–∞–ª–µ–Ω (< 48 —á–∞—Å–æ–≤)
- [x] Git hooks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- **Zero cyclic dependencies** ‚Äî –Ω–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **Clean export usage** ‚Äî –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ < 10
- **Fresh analysis** ‚Äî –∞–Ω–∞–ª–∏–∑ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
- **Memory Graph updated** ‚Äî MCP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
- **Accounting domain valid** ‚Äî –≤—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–±–ª—é–¥–µ–Ω—ã
- **Git hooks active** ‚Äî pre-commit –∏ pre-push —Ä–∞–±–æ—Ç–∞—é—Ç

–°–ª–µ–¥—É–π —ç—Ç–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º —Å—Ç—Ä–æ–≥–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –æ–Ω—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –≥—Ä–∞—Ñ–∞ –≤ Accounting –¥–æ–º–µ–Ω–µ!   - –°–æ–∑–¥–∞—Ç—å src/types/Subscription.ts
